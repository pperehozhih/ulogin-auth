setHttps();var width=800;var height=600;var query=new Object();var socket;var tmp=location.search.substr(1).split("&");var tmp2;for(var i=0;i<tmp.length;i++){tmp2=tmp[i].split("=");query[tmp2[0]]=tmp2[1]}var network="";var interval=0;var readyinterval=0;var formid=0;var position={vkontakte:1,odnoklassniki:2,mailru:3,facebook:4,twitter:5,google:6,yandex:7,livejournal:8,openid:9,guest:10,flickr:11,lastfm:12,linkedin:13,liveid:14,soundcloud:15,steam:16,vimeo:17,webmoney:18,youtube:19};var names={ru:{vkontakte:"ВКонтакте",odnoklassniki:"Одноклассники",mailru:"Mail.ru",facebook:"Facebook",twitter:"Twitter",google:"Google",yandex:"Яндекс",livejournal:"Живой\u00a0Журнал",openid:"OpenID",guest:"Гость",flickr:"Flickr",lastfm:"Last.FM",linkedin:"LinkedIn",liveid:"Live ID",soundcloud:"SoundCloud",steam:"Steam",vimeo:"Vimeo",webmoney:"WebMoney",youtube:"YouTube"},en:{vkontakte:"VK",odnoklassniki:"Odnoklassniki",mailru:"Mail.ru",facebook:"Facebook",twitter:"Twitter",google:"Google",yandex:"Yandex",livejournal:"LiveJournal",openid:"OpenID",guest:"Guest",flickr:"Flickr",lastfm:"Last.FM",linkedin:"LinkedIn",liveid:"Live ID",soundcloud:"SoundCloud",steam:"Steam",vimeo:"Vimeo",webmoney:"WebMoney",youtube:"YouTube"}};var error_msg={ru:{linked:"Связанные аккаунты ЖЖ не поддерживают авторизацию на других сайтах",url:"Неверный идентификатор пользователя"},en:{linked:"Linked accounts of Live Journal do not support authorization at other sites",url:"Wrong user ID"},uk:{linked:"Пов'язанi акаунти ЖЖ не підтримують авторизацію на інших сайтах",url:"Невірний ідентифікатор користувача"}};var lang=query.lang?query.lang:(navigator.language?navigator.language:navigator.userLanguage).substr(0,2);if(lang!="ru"&&lang!="en"){names[lang]=names.en}var forms={livejournal:1,openid:1,webmoney:1};var issmall=0;if(document.readyState!="complete"){readyinterval=setInterval("checkReady()",10)}else{initwin()}function setHttps(){https=location.href.match(/^https/i)?true:false;if(!https){var a="https"+location.href.substr(4);location.href=a}}function isIE(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var a=new Number(RegExp.$1);if(a<=8){return true}}return false}function parse(c){var e=new Object();if(!c){return e}var d=c.split("&");for(var a=0;a<d.length;a++){var b=d[a].split("=");if(b[0]){b[0]=b[0].trim()}if(b[1]){b[1]=b[1].trim()}e[b[0]]=b[1]}return e}function getById(a){return document.getElementById(a)}function addEvent(a,c,b){if(a.addEventListener){if(b){a.addEventListener(c,function(d){b(a,d)},false)}else{a.removeEventListener(c,b,false)}}else{if(a.attachEvent){if(b){a.attachEvent("on"+c,function(d){b(a,d)})}else{a.detachEvent(c,b)}}else{if(b){a["on"+c]=function(d){b(a,d)}}else{a["on"+c]=null}}}}function childProcessing(c,b){var a=0;while(c[a]){b(c[a]);a++}}function popup(h,e){if(typeof query.auto!="undefined"){location.href="https://ulogin.ru/auth.php?name="+h+"&window=0&lang="+query.lang+"&client="+query.client+"&fields="+query.fields+"&optional="+query.optional+"&redirect_uri="+query.redirect_uri+"&verify="+query.verify+"&callback="+query.callback+(typeof e!="undefined"?"&url="+e:"");return}if(network){var d=getById(network);var c=d.childNodes?d.childNodes:[];childProcessing(c,function(l){var k=l.childNodes?l.childNodes:[];childProcessing(k,function(m){if(m.style){m.style.background="none"}});if(l.style){l.style.backgroundImage="url(img/panel4.png)"}});clearInterval(interval)}network=h;if(typeof e!="undefined"){var b=new Date();b.setTime(b.getTime()+(31536000000));document.cookie=h+"url = "+e+"; expires = "+b.toGMTString()+"; path=/"}var a=getById(h);var f=a.childNodes?a.childNodes:[];childProcessing(f,function(l){var k=l.childNodes?l.childNodes:[];childProcessing(k,function(m){if(m.style){m.style.background="url(img/preloader.png) no-repeat"}})});a.style.filter="alpha(opacity=55) progid:DXImageTransform.Microsoft.AlphaImageLoader(src=transparent.png, sizingMethod='crop'";a.style.opacity="0.55";if(query.window=="2"){window.location.href="https://ulogin.ru/auth.php?name="+network+"&window=0&lang="+query.lang+"&client="+query.client+"&fields="+query.fields+"&optional="+query.optional+"&redirect_uri="+query.redirect_uri+"&callback="+query.callback+(typeof e!="undefined"?"&url="+e:"")+"&verify="+query.verify+"&screen="+screen.height+"x"+screen.width+"&host="+query.host;window.resizeTo(width,height)}else{b=new Date();b.setTime(b.getTime()+(86400000));if(document.cookie){document.cookie="q = "+encodeURIComponent(location.toString())+"; expires = "+b.toGMTString()+"; path=/"}win_url="https://ulogin.ru/auth.php?name="+network+"&window=1&lang="+query.lang+"&client="+query.client+"&fields="+query.fields+"&optional="+query.optional+"&redirect_uri="+query.redirect_uri+"&host="+query.host+"&callback="+query.callback+(typeof e!="undefined"?"&url="+e:"")+"&verify="+query.verify+"&q="+encodeURIComponent(location.toString())+"&screen="+screen.width+"x"+screen.height;var g="width="+width+",height="+height+",left="+((screen.width-width)/2)+",top="+((screen.height-height)/2);if(h=="livejournal"||h=="steam"){g="width="+screen.width+", height="+screen.height+", top=0, left=0, fullscreen=yes, scrollbar=auto"}sendMessage("open");uLogin=window.open(win_url,"uLogin",g);interval=setInterval(check,1000)}}function check(){if(uLogin){if(uLogin.closed){sendMessage("close");var b=getById(network);var a=b.childNodes?b.childNodes:[];childProcessing(a,function(d){var c=d.childNodes?d.childNodes:[];childProcessing(c,function(e){if(e.style){e.style.background="none"}})});b.style.filter="";b.style.opacity="";clearInterval(interval)}}}function receiver(b,a,d,c){if(a){r_prot=a.match(/^https/i)?"https":"http";if(r_prot!=query.protocol){parsed_uri=a.split(":");parsed_uri.splice(0,1);a=query.protocol+":"+parsed_uri.join(":")}sendMessage("receive");window.location.href=a+"?token="+b+"&callback="+d+"&q="+encodeURIComponent(c)}else{sendMessage(b)}}function redirect(c,b){r_prot=b.match(/^https/i)?"https":"http";if(r_prot=="http"){sendMessage("receive");window.location.href="http://ulogin.ru/http.html?redirect_uri="+encodeURIComponent(b)+"&token="+c+"&q="+encodeURIComponent(location.href)}else{var d=document.createElement("form");d.action=b;d.method="post";d.target="_top";d.style.display="none";var a=document.createElement("input");a.type="hidden";a.name="token";a.value=c;d.appendChild(a);document.body.appendChild(d);d.submit()}}function fill(e,a,k,g,h,l,c){var f=parse(location.search.split("?")[1]);c+="?xdm_c="+f.xdm_c+"&xdm_e="+f.xdm_e+"&xdm_p="+f.xdm_p;var b=document.createElement("form");b.setAttribute("method","post");b.setAttribute("action",c);var d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","token");d.setAttribute("value",e);b.appendChild(d);d=document.createElement("input");d.setAttribute("name","redirect_uri");d.setAttribute("value",a);b.appendChild(d);d=document.createElement("input");d.setAttribute("name","callback");d.setAttribute("value",k);b.appendChild(d);d=document.createElement("input");d.setAttribute("name","fields");d.setAttribute("value",g);b.appendChild(d);d=document.createElement("input");d.setAttribute("name","phone_code");d.setAttribute("value",h);b.appendChild(d);d=document.createElement("input");d.setAttribute("name","filled");d.setAttribute("value",l);b.appendChild(d);b.style.display="none";document.body.appendChild(b);b.submit()}function show_error(b,d){getById(d+"url").style.color="red";var c=getById("url_error_msg");var a=c.firstChild;if(a){a.innerHTML=error_msg[lang][b]}}function hide_error(a){getById(a+"url").style.color="";getById("url_error_msg").childNodes[0].innerText=""}function mouseover(a,d){var b=a?a:d.srcElement;if(!issmall&&b){b.style.backgroundColor="#ffffff";var c=b.childNodes?b.childNodes:[];childProcessing(c,function(f){var e=f.childNodes;childProcessing(e,function(g){if(g.style){g.style.color="#333"}})})}}function mouseout(a,d){var b=a?a:d.srcElement;if(!issmall&&b){b.style.backgroundColor="#e6e6e6";var c=b.childNodes?b.childNodes:[];childProcessing(c,function(f){var e=f.childNodes;childProcessing(e,function(g){if(g.style){g.style.color="#777"}})})}}function initform(c,a,e){var b=getById("col3");if(b){var d=document.getElementsByTagName("*")}childProcessing(d,function(f){if(f.style){if(f.className=="col"){f.style.width=c;var g=f.childNodes?f.childNodes:[];childProcessing(g,function(h){var k=h.childNodes?h.childNodes:[];childProcessing(k,function(m){var l=m.childNodes?m.childNodes:[];childProcessing(l,function(n){if(n.style){n.style.width=a;n.style.paddingLeft="15px"}})})})}else{if(f.className=="a"){f.style.cursor=e}}}})}function form_display(b){var a=getById(formid+"title");if(a){if(a.style){a.style.display=b}}a=getById(formid+"desc");if(a){if(a.style){a.style.display=b}}a=getById(formid+"placeurl");if(a){if(a.style){a.style.display=b}}a=getById(formid+"placebutton");if(a){if(a.style){a.style.display=b}}}function small(a,c){var b=a?a:c.srcElement;if(issmall){return}issmall=1;if(formid){form_display("none");formid=0}if(typeof query.auto!="undefined"&&query.auto!="livejournal"&&query.auto!="openid"&&query.auto!="webmoney"){formid="any"}else{formid=b.firstChild?b.firstChild.getAttribute("id"):null;if(b.firstChild.style){b.firstChild.style.background="none"}}initform("63px","63px","default");form_display("block");formid_elem=getById("form");if(formid_elem){formid_elem.style.display="block"}formid_elem=getById(formid+"url");if(formid_elem){formid_elem.focus()}hide_error(formid)}function full(){issmall=0;var b=getById(formid);var a=b.parentNode;mouseout(a,Object);b.style.background="url(/img/bgb.png) right repeat-y";b=getById("form");if(b){b.style.display="none"}initform("188","","pointer")}function checkReady(){if(document.readyState=="complete"){clearInterval(readyinterval);initwin()}}function clientWidth(){var a=0;if(Object.prototype.toString.call(window.opera)=="[object Opera]"&&(window.parseFloat(window.opera.version())<9.5)||isIE()){a=document.body.clientWidth}else{if(window.innerWidth){a=window.innerWidth}}return a}function clientHeight(){var a=0;if(Object.prototype.toString.call(window.opera)=="[object Opera]"&&(window.parseFloat(window.opera.version())<9.5)||isIE()){a=document.body.clientHeight}else{if(window.innerHeight){a=window.innerHeight}}return a}function resizeWindow(){var b=564-clientWidth();var a=358-clientHeight();if(b!=0||a!=0){window.resizeBy(b,a)}}function sendMessage(b){if(!query.xdm_c||!query.xdm_e||!query.xdm_p){return}if(!socket){socket=new easyXDM.Socket({swf:isIE()?"https://ulogin.ru/js/easyxdm.swf":"",onReady:function(){try{socket.postMessage(b)}catch(c){}}})}else{try{socket.postMessage(b)}catch(a){}}}function initwin(){if(typeof query.auto!="undefined"){window.setInterval(resizeWindow,100)}if(!query.fields){return}if(!names[lang]){lang="ru"}var e="vkontakte,odnoklassniki,mailru,facebook,twitter,google,yandex,steam,soundcloud,linkedin,lastfm,liveid,flickr,vimeo,youtube,livejournal,openid,webmoney";e=e.split(",");col=3;var b=Math.ceil(e.length/col);if(b<7){b=7}var d=getById("form");if(d){d.style.width="375px";d.style.height=(b*44-1+15)+"px"}document.body.style.overflow="hidden";for(j=0;j<col;j++){for(i=j*b;i<j*b+(j<(col-1)?b:e.length-(col-1)*b);i++){div=document.createElement("div");div.innerHTML='<div id="a'+(i+1)+'" class="a"><div id="'+e[i]+'" class="b"><a style="background-position:15px -'+(position[e[i]]*35+1)+'px"><img src="img/blank.gif" style="width:40px;height:32px;margin-right: 5px;" alt=""/>'+names[lang][e[i]]+"</a></div></div>";if(typeof query.auto!="undefined"||typeof forms[e[i]]!="undefined"){addEvent(div.firstChild,"click",small);obj1=getById(e[i]+"button");if(obj1){addEvent(obj1,"click",function(g,h){var l=(g.id).substr(0,(g.id).indexOf("button"));var k=getById(l+"url")?getById(l+"url").value:"";if(k.length>0){if(/ext_(\d+)/.test(k)&&l=="livejournal"){show_error("linked",l)}else{popup(l,k)}}})}obj2=getById(e[i]+"url");if(obj2){addEvent(obj2,"keydown",function(g,h){var l=g.id.substr(0,g.id.indexOf("url"));var k=g.value;if(h.keyCode=="13"&&k.length>0){if(/ext_(\d+)/.test(k)&&l=="livejournal"){show_error("linked",l)}else{popup(l,k)}}})}var f="";if(document.cookie){f=new RegExp("(?:^|; )"+encodeURIComponent(e[i]+"url")+"=([^;]*)").exec(document.cookie)}list_url=getById(e[i]+"url");if(list_url){list_url.setAttribute("value",f?f[1]:"")}}else{obj=div.firstChild;addEvent(obj,"click",function(g,k){var h=(g.id?g:k.srcElement);if(!issmall){popup(h.childNodes[0].getAttribute("id"))}});getById("placefull").style.display="block"}addEvent(div.firstChild,"mouseover",mouseover);addEvent(div.firstChild,"mouseout",mouseout);element=getById("col"+(j+1));if(element){element.appendChild(div.firstChild)}if(typeof query.auto!="undefined"&&query.auto==e[i]){getById("placefull").style.display="none";mouseover(element.lastChild,Object);small(element.lastChild,Object)}}var a=document.createElement("div");if(j==col-1){a.innerHTML='<div class="last" style="height:'+((col*b-e.length)*44+15)+'px;"></div>';element=getById("col"+(j+1));if(element){element.appendChild(a)}}else{a.innerHTML='<div class="last" style="height:15px;"></div>';element=getById("col"+(j+1));if(element){element.appendChild(a)}}}if(typeof query.auto!="undefined"&&position[query.auto]<8){var c=getById("col2").innerHTML;getById("col2").innerHTML=getById("col3").innerHTML;getById("col3").innerHTML=c}else{sendMessage("ready")}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}};